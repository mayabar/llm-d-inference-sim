---
# Prefill Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vllm-sim-p
spec:
  replicas: 1
  selector:
    matchLabels:
      llm-d.ai/role: prefill
  template:
    metadata:
      labels:
        llm-d.ai/role: prefill
    spec:
      containers:
        - name: vllm-prefill
          image: ghcr.io/llm-d/llm-d-inference-sim:latest
          imagePullPolicy: IfNotPresent
          args:
            - "--v=4"
            - "--port=8000"
            - "--model=meta-llama/Llama-3.1-8B-Instruct"
            - "--data-parallel-size=1"
            - "--prefill-time-per-token=200"
            - "--prefill-time-std-dev=3"
          ports:
            - containerPort: 8000
---
# Decode Deployment (with routing-sidecar + vLLM simulator)
apiVersion: apps/v1
kind: Deployment
metadata:
  name: vllm-sim-d
spec:
  replicas: 1
  selector:
    matchLabels:
      llm-d.ai/role: decode
  template:
    metadata:
      labels:
        llm-d.ai/role: decode
    spec:
      containers:
        - name: routing-sidecar
          image: ghcr.io/llm-d/llm-d-routing-sidecar:v0.3.1-rc.1
          imagePullPolicy: IfNotPresent
          args:
            - "--v=4"
            - "--port=8000"
            - "--vllm-port=8200"
            - "--connector=nixlv2"
            - "--secure-proxy=false"
          ports:
            - containerPort: 8000
        - name: vllm-decode
          image: ghcr.io/llm-d/llm-d-inference-sim:latest
          imagePullPolicy: IfNotPresent
          args:
            - "--v=4"
            - "--port=8200"
            - "--model=meta-llama/Llama-3.1-8B-Instruct"
            - "--data-parallel-size=1"
          ports:
            - containerPort: 8200
---
apiVersion: v1
kind: Service
metadata:
  name: vllm-sim-p-service
spec:
  selector:
    llm-d.ai/role: prefill
  ports:
    - protocol: TCP
      port: 8000
      targetPort: 8000
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: vllm-sim-d-service
spec:
  selector:
    llm-d.ai/role: decode
  ports:
    - protocol: TCP
      port: 8000
      targetPort: 8000
  type: ClusterIP